# OpenBSD

## upgrade to 6.2
_Detailed manual and configuration changes_: https://www.openbsd.org/faq/upgrade62.html

* create working directory
  ```
  rm -rf /usr/rel
  mkdir -p /usr/rel
  cd /usr/rel
  ```

* download release files
  ```
  export MIRROR=https://ftp.eu.openbsd.org/pub/OpenBSD/6.2/amd64
  ftp ${MIRROR}/bsd
  ftp ${MIRROR}/bsd.mp
  ftp ${MIRROR}/bsd.rd
  ftp ${MIRROR}/xshare62.tgz
  ftp ${MIRROR}/xserv62.tgz
  ftp ${MIRROR}/xfont62.tgz
  ftp ${MIRROR}/xbase62.tgz
  ftp ${MIRROR}/man62.tgz
  ftp ${MIRROR}/game62.tgz
  ftp ${MIRROR}/comp62.tgz
  ftp ${MIRROR}/base62.tgz
  unset MIRROR
  ```

* install new kernel
  * _multiprocessor_
    ```
    ln -f /bsd /obsd && cp bsd.mp /nbsd && mv /nbsd /bsd
    cp bsd.rd /
    cp bsd /bsd.sp
    ```
  
  * _single processor_
    ```
    ln -f /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
    cp bsd.rd bsd.mp /
    ```

* enable KARL (_kernel address randomized link_)
  ```
  sha256 -h /var/db/kernel.SHA256 /bsd
  ```

* remove old files
  ```
  rm -rf /usr/share/man
  rm -rf /usr/obj/*
  ```

* install new userland
  ```
  cp /sbin/reboot /sbin/oreboot
  tar -C / -xzphf xshare62.tgz
  tar -C / -xzphf xserv62.tgz
  tar -C / -xzphf xfont62.tgz
  tar -C / -xzphf xbase62.tgz
  tar -C / -xzphf man62.tgz
  tar -C / -xzphf game62.tgz
  tar -C / -xzphf comp62.tgz
  tar -C / -xzphf base62.tgz
  /sbin/oreboot
  ```

* update `/dev`
  ```
  cd /dev
  ./MAKEDEV all
  ```

* update bootloader
  ```
  installboot sd0
  ```

* update system configuration files
  ```
  sysmerge
  ```

* update firmware
  ```
  fw_update
  ```

* reboot
  ```
  reboot
  ```

* remove `/sbin/oreboot` and upgrade packages:
  ```
  rm /sbin/oreboot
  pkg_add -u
  ```

* reboot (_ to make sure you run on your own kernel generated by KARL_)
  ```
  reboot
  ```
